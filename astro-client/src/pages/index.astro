---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const pokedex = await getCollection("pokemon");
pokedex.sort((a, b) => a.data.id - b.data.id)
---

<BaseLayout title="Pokédex">

  <style>
    .search-container {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    input[type="text"] {
      padding: 0.7rem 1rem;
      width: 260px;
      font-size: 1rem;
      border-radius: var(--radius);
      border: 1px solid var(--ctp-surface1);
      background: var(--ctp-surface0);
      color: var(--ctp-text);
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--ctp-blue);
      box-shadow: 0 0 0 2px rgba(138,173,244,0.3);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }

    .card {
      background: var(--ctp-surface0);
      padding: 1rem;
      border-radius: var(--radius);
      text-align: center;
      text-decoration: none;
      color: var(--ctp-text);
      border: 1px solid var(--ctp-surface1);
      transition: transform 0.2s ease, border-color 0.2s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      border-color: var(--ctp-blue);
    }

    .card h2 {
      margin: 0.5rem 0 0;
      color: var(--ctp-lavender);
      font-size: 1.2rem;
    }

    .id {
      color: var(--ctp-subtext);
      font-size: 0.85rem;
    }
  </style>

  <div class="search-container">
    <input id="search" type="text" placeholder="Search by name or ID…" />
  </div>

  <div id="results" class="grid">
    {pokedex.map((p) => (
      <a class="card" href={`/pokemon/${p.id}`}>
        <div class="id">#{p.data.id}</div>
        <h2>{p.data.name}</h2>
      </a>
    ))}
  </div>

  <script>
    const input = document.getElementById("search");
    const results = document.getElementById("results");
    const cards = [...results!.children];

    input!.addEventListener("input", () => {
      const q = input.value.toLowerCase().trim();
      for (const card of cards) {
        const name = card.querySelector("h2")!.textContent.toLowerCase();
        const number = card.querySelector(".id")!.textContent;
        const show = name.includes(q) || number.includes(q);
        card.style.display = show ? "" : "none";
      }
    });
  </script>

</BaseLayout>
